<script>
var erisk = (function(my) {

    const $ = domUtils.$;
    const WARNING_TIME = 15;

    // make the HUMAN_MOVE_TIME_LIMIT time a const. Active only when more than one human player.
    let expirationTimer = null;
    let expirationTimeRemaining;

    /* Starts the timer if there is not one running already,
     * or restarts the timer so we have the corrent context.
     */
    my.startExpirationTimer = function(expirationCallback) {

        domUtils.show('move-expiration');

        if (expirationTimer) {
            // stop the current one, and start new so we have the correct context
            clearInterval(expirationTimer);
        }
        else {
            expirationTimeRemaining = CONSTS.HUMAN_TIME_LIMIT;
            $('remaining-time').textContent = expirationTimeRemaining;
        }

        expirationTimer = setInterval(expirationTimerCB, 1000);

        function expirationTimerCB() {
            const remainingTime = $('remaining-time')
            remainingTime.textContent = --expirationTimeRemaining;
            domUtils.toggleClass(remainingTime, 'glow', true);
            setTimeout(() => domUtils.toggleClass(remainingTime, 'glow', false), 300);

            if (expirationTimeRemaining > 0 && expirationTimeRemaining <= WARNING_TIME) {
                audio.playSound(CONSTS.SOUNDS.ALMOST_OUT_OF_TIME);
            }
            else if (expirationTimeRemaining <= 0) {
                audio.playSound(CONSTS.SOUNDS.OUT_OF_TIME);

                expirationCallback();
            }
        }
    }

    my.stopExpirationTimer = function() {
        clearInterval(expirationTimer);
        expirationTimer = null;
        domUtils.hide('move-expiration');
    }

    return my;
}(erisk || {}));
</script>